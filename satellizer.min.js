!function(t,e){"use strict";function n(){this.config=s,this.providers=h,this.facebook=function(t){e.extend(h.facebook,t)},this.google=function(t){e.extend(h.google,t)},this.linkedin=function(t){e.extend(h.linkedin,t)},this.github=function(t){e.extend(h.github,t)},this.twitter=function(t){e.extend(h.twitter,t)},this.oauthBase=function(t){h[t.name]=h[t.name]||{},e.extend(h[t.name],t)},this.oauth1=function(t){this.oauthBase(t),h[t.name].type="1.0"},this.oauth2=function(t){this.oauthBase(t),h[t.name].type="2.0"},this.$get=function(t,e,n,o){var i={};return i.authenticate=function(t){var i="1.0"===h[t].type?e:n;return i.open(h[t]).then(function(t){return o.parseUser(t.token)})},i.login=function(t){return o.login(t)},i.signup=function(t){return o.signup(t)},i.logout=function(){o.logout()},i.isAuthenticated=function(){return o.isAuthenticated()},i}}function o(e,n,o,i){var r={};return r.parseUser=function(e){var n=JSON.parse(t.atob(e.split(".")[1]));return localStorage.setItem("jwtToken",e),o[s.user]=n.user,i.path(s.loginRedirect),n.user},r.login=function(t){return n.post(s.loginUrl,t).then(function(t){return r.parseUser(t.data.token)})},r.signup=function(t){return n.post(s.signupUrl,t).then(function(){i.path(s.signupRedirect)})},r.logout=function(){delete o[s.user],localStorage.removeItem("jwtToken"),i.path(s.logoutRedirect)},r.isAuthenticated=function(){return Boolean(o.currentUser)},r}function i(t,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(e,n){var r=t.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(e,"Satellizer",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(t){r=n(function(){i.closed&&(n.cancel(r),t.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(t){o.addEventListener("message",function(e){e.origin===o.location.origin&&t.resolve(e.data)},!1)},u.prepareOptions=function(t){var n=t.width||500,i=t.height||500;return e.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},t)},u.stringifyOptions=function(t){var n=[];return e.forEach(t,function(t,e){n.push(e+"="+t)}),n.join(",")},u}function r(t,n,o){var i={url:null,name:null,popupOptions:null},r={};return r.open=function(t){return e.extend(i,t),o.open(i.url).then(function(t){return r.exchangeForToken(t).then(function(t){return t.data})})},r.exchangeForToken=function(t){return t=r.buildQueryString(t),n.get(i.url+"?"+t)},r.buildQueryString=function(t){var n=[];return e.forEach(t,function(t,e){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),n.join("&")},r}function u(t,n,o,i){var r={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(t){e.extend(r,t);var n=u.buildUrl();return i.open(n,r.popupOptions).then(function(t){return u.exchangeForToken(t).then(function(t){return t.data})})},u.exchangeForToken=function(t){return n.post(r.url,{code:t.code,clientId:r.clientId,redirectUri:r.redirectUri})},u.buildUrl=function(){var t=r.authorizationEndpoint,e=u.buildQueryString();return[t,e].join("?")},u.buildQueryString=function(){var t=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return e.forEach(n,function(n){e.forEach(r[n],function(e){var n=o.camelCase(e),i=r[n];t.push([e,encodeURIComponent(i)])})}),t.map(function(t){return t.join("=")}).join("&")},u}function a(t){t.interceptors.push(function(t,e,n){return{request:function(t){return e.localStorage.jwtToken&&(t.headers.Authorization="Bearer "+e.localStorage.jwtToken),t},responseError:function(o){return(401===o.status||403===o.status)&&(delete e.localStorage.jwtToken,n.path("/login")),t.reject(o)}}})}function c(t){t.run()}function l(t,e,n,o){return{run:function(){var i=e.localStorage.jwtToken;if(i){var r=JSON.parse(e.atob(i.split(".")[1]));t.currentUser=r.user}var u=e.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);e.opener&&e.opener.location.origin===e.location.origin&&(a.oauth_token&&a.oauth_verifier?e.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&e.opener.postMessage({code:a.code},"*"),e.close())}}}function p(){this.camelCase=function(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(t){var n,o,i={};return e.forEach((t||"").split("&"),function(t){t&&(o=t.split("="),n=decodeURIComponent(o[0]),i[n]=e.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}e.module("Satellizer",[]).provider("$auth",n).factory("RunBlock",l).factory("Local",o).factory("Oauth2",u).factory("Oauth1",r).factory("Popup",i).service("Utils",p).config(a).run(c);var s={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},h={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:t.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:t.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:t.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:t.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}};o.$inject=["$q","$http","$rootScope","$location"],i.$inject=["$q","$interval","$window"],r.$inject=["$q","$http","Popup"],u.$inject=["$q","$http","Utils","Popup"],a.$inject=["$httpProvider"],c.$inject=["RunBlock"],l.$inject=["$rootScope","$window","$location","Utils"]}(window,window.angular);