!function(e,t){"use strict";t.module("satellizer",[]).constant("satellizer.config",{logoutRedirect:"/",loginRedirect:"/",signupRedirect:"/login",loginUrl:"/auth/login",signupUrl:"/auth/signup",loginRoute:"/login",signupRoute:"/signup",tokenName:"token",tokenPrefix:"satellizer",unlinkUrl:"/auth/unlink/",providers:{google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display","scope"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:e.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}}}).provider("$auth",["satellizer.config",function(e){Object.defineProperties(this,{logoutRedirect:{get:function(){return e.logoutRedirect},set:function(t){e.logoutRedirect=t}},loginRedirect:{set:function(t){e.loginRedirect=t},get:function(){return e.loginRedirect}},signupRedirect:{get:function(){return e.signupRedirect},set:function(t){e.signupRedirect=t}},loginUrl:{get:function(){return e.loginUrl},set:function(t){e.loginUrl=t}},signupUrl:{get:function(){return e.signupUrl},set:function(t){e.signupUrl=t}},loginRoute:{get:function(){return e.loginRoute},set:function(t){e.loginRoute=t}},signupRoute:{get:function(){return e.signupRoute},set:function(t){e.signupRoute=t}},tokenName:{get:function(){return e.tokenName},set:function(t){e.tokenName=t}},tokenPrefix:{get:function(){return e.tokenPrefix},set:function(t){e.tokenPrefix=t}},unlinkUrl:{get:function(){return e.unlinkUrl},set:function(t){e.unlinkUrl=t}}}),this.facebook=function(n){t.extend(e.providers.facebook,n)},this.google=function(n){t.extend(e.providers.google,n)},this.linkedin=function(n){t.extend(e.providers.linkedin,n)},this.github=function(n){t.extend(e.providers.github,n)},this.twitter=function(n){t.extend(e.providers.twitter,n)};var n=function(n){e.providers[n.name]=e.providers[n.name]||{},t.extend(e.providers[n.name],n)};this.oauth1=function(t){n(t),e.providers[t.name].type="1.0"},this.oauth2=function(t){n(t),e.providers[t.name].type="2.0"},this.$get=["$q","satellizer.shared","satellizer.local","satellizer.oauth",function(t,n,o,i){var r={};return r.authenticate=function(e){return i.authenticate(e)},r.login=function(e){return o.login(e)},r.signup=function(e){return o.signup(e)},r.logout=function(){return n.logout()},r.isAuthenticated=function(){return n.isAuthenticated()},r.link=function(e){return r.authenticate(e)},r.unlink=function(e){return i.unlink(e)},r.updateToken=function(t){localStorage.setItem([e.tokenPrefix,e.tokenName].join("_"),t)},r}]}]).factory("satellizer.shared",["$q","$window","$location","satellizer.config",function(e,t,n,o){var i={};return i.parseUser=function(e,i){var r=[o.tokenPrefix,o.tokenName].join("_");t.localStorage[r]=e,o.loginRedirect&&n.path(o.loginRedirect),i.resolve()},i.isAuthenticated=function(){var e=[o.tokenPrefix,o.tokenName].join("_");return Boolean(t.localStorage[e])},i.logout=function(){var i=e.defer(),r=[o.tokenPrefix,o.tokenName].join("_");return delete t.localStorage[r],i.resolve(),o.logoutRedirect&&n.path(o.logoutRedirect),i.promise},i}]).factory("satellizer.oauth",["$q","$http","satellizer.config","satellizer.shared","satellizer.Oauth1","satellizer.Oauth2",function(e,t,n,o,i,r){var u={};return u.authenticate=function(t){var u=e.defer(),a="1.0"===n.providers[t].type?new i:new r;return a.open(n.providers[t]).then(function(e){o.parseUser(e.data[n.tokenName],u)}).catch(function(e){u.reject(e)}),u.promise},u.unlink=function(i){var r=e.defer();return t.get(n.unlinkUrl+i).then(function(e){o.parseUser(e.data[n.tokenName],r)}).catch(function(e){r.reject(e)}),r.promise},u}]).factory("satellizer.local",["$q","$http","$location","$rootScope","satellizer.utils","satellizer.shared","satellizer.config",function(e,t,n,o,i,r,u){var a={};return a.login=function(n){var o=e.defer();return t.post(u.loginUrl,n).then(function(e){r.parseUser(e.data[u.tokenName],o)}).catch(function(e){o.reject(e)}),o.promise},a.signup=function(o){var i=e.defer();return t.post(u.signupUrl,o).then(function(){n.path(u.signupRedirect),i.resolve()}).catch(function(e){i.reject(e)}),i.promise},a}]).factory("satellizer.Oauth2",["$q","$http","satellizer.popup","satellizer.utils",function(e,n,o,i){return function(){function r(n){t.extend(c,n);var i=e.defer(),r=a();return o.open(r,c.popupOptions).then(function(e){u(e).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}function u(e){return n.post(c.url,{code:e.code,clientId:c.clientId,redirectUri:c.redirectUri})}function a(){var e=c.authorizationEndpoint,t=l();return[e,t].join("?")}function l(){var e=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return t.forEach(n,function(n){t.forEach(c[n],function(t){var n=i.camelCase(t),o=c[n];e.push([t,encodeURIComponent(o)])})}),e.map(function(e){return e.join("=")}).join("&")}var c={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"};return{open:r,exchangeForToken:u,buildUrl:a,buildQueryString:l}}}]).factory("satellizer.Oauth1",["$q","$http","satellizer.popup",function(e,n,o){return function(){function i(n){t.extend(a,n);var i=e.defer();return o.open(a.url).then(function(e){r(e).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}function r(e){return e=u(e),n.get(a.url+"?"+e)}function u(e){var n=[];return t.forEach(e,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")}var a={url:null,name:null,popupOptions:null};return{open:i,exchangeForToken:r,buildQueryString:u}}}]).factory("satellizer.popup",["$q","$interval","$window",function(e,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(t,n){var r=e.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(t,"_blank",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(e){r=n(function(){i.closed&&(n.cancel(r),e.reject({data:"Authorization Failed"}))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(t){t.origin===o.location.origin&&(i.close(),t.data.error?e.reject({data:t.data.error}):e.resolve(t.data))},!1)},u.prepareOptions=function(e){var n=e.width||500,i=e.height||500;return t.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},e)},u.stringifyOptions=function(e){var n=[];return t.forEach(e,function(e,t){n.push(t+"="+e)}),n.join(",")},u}]).service("satellizer.utils",function(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(e){var n,o,i={};return t.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),n=decodeURIComponent(o[0]),i[n]=t.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}).config(["$httpProvider","satellizer.config",function(e,t){e.interceptors.push(["$q",function(e){return{request:function(e){return localStorage.getItem([t.tokenPrefix,t.tokenName].join("_"))&&(e.headers.Authorization="Bearer "+localStorage.getItem([t.tokenPrefix,t.tokenName].join("_"))),e},responseError:function(n){return 401===n.status&&localStorage.removeItem([t.tokenPrefix,t.tokenName].join("_")),e.reject(n)}}}])}]).run(["$rootScope","$window","$location","satellizer.utils","satellizer.config",function(e,t,n,o,i){var r=localStorage.getItem([i.tokenPrefix,i.tokenName].join("_"));r&&(e.isAuthenticated=!0);var u=t.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);t.opener&&t.opener.location.origin===t.location.origin&&(a.oauth_token&&a.oauth_verifier?t.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},t.location.origin):a.code?t.opener.postMessage({code:a.code},t.location.origin):a.error&&t.opener.postMessage({error:a.error},t.location.origin))}])}(window,window.angular);