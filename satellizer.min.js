!function(t,e){"use strict";function n(){this.config=s,this.providers=h,this.facebook=function(t){e.extend(h.facebook,t)},this.google=function(t){e.extend(h.google,t)},this.linkedin=function(t){e.extend(h.linkedin,t)},this.twitter=function(t){e.extend(h.twitter,t)},this.oauthBase=function(t){h[t.name]=h[t.name]||{},e.extend(h[t.name],t)},this.oauth1=function(t){this.oauthBase(t),h[t.name].type="1.0"},this.oauth2=function(t){this.oauthBase(t),h[t.name].type="2.0"},this.$get=function(t,e,n,o){var r={};return r.authenticate=function(t){var r="1.0"===h[t].type?e:n;return r.open(h[t]).then(function(t){return o.parseUser(t.token)})},r.login=function(t){return o.login(t)},r.signup=function(t){return o.signup(t)},r.logout=function(){o.logout()},r.isAuthenticated=function(){return o.isAuthenticated()},r}}function o(e,n,o,r){var i={};return i.parseUser=function(e){var n=JSON.parse(t.atob(e.split(".")[1]));return localStorage.setItem("jwtToken",e),o[s.user]=n.user,r.path(s.loginRedirect),n.user},i.login=function(t){return n.post(s.loginUrl,t).then(function(t){return i.parseUser(t.data.token)})},i.signup=function(t){return n.post(s.signupUrl,t).then(function(){r.path(s.signupRedirect)})},i.logout=function(){delete o[s.user],localStorage.removeItem("jwtToken"),r.path(s.logoutRedirect)},i.isAuthenticated=function(){return Boolean(o.currentUser)},i}function r(t,n,o){var r=null,i=null,u={};return u.popupWindow=r,u.open=function(e,n){var i=t.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return r=o.open(e,"Satellizer",a),r.focus(),u.postMessageHandler(i),u.pollPopup(i),i.promise},u.pollPopup=function(t){i=n(function(){r.closed&&(n.cancel(i),t.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(t){o.addEventListener("message",function(e){e.origin===o.location.origin&&t.resolve(e.data)},!1)},u.prepareOptions=function(t){var n=t.width||500,r=t.height||500;return e.extend({width:n,height:r,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-r)/2.5},t)},u.stringifyOptions=function(t){var n=[];return e.forEach(t,function(t,e){n.push(e+"="+t)}),n.join(",")},u}function i(t,n,o){var r={url:null,name:null,popupOptions:null},i={};return i.open=function(t){return e.extend(r,t),o.open(r.url).then(function(t){return i.exchangeForToken(t).then(function(t){return t.data})})},i.exchangeForToken=function(t){return t=i.buildQueryString(t),n.get(r.url+"?"+t)},i.buildQueryString=function(t){var n=[];return e.forEach(t,function(t,e){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),n.join("&")},i}function u(t,n,o,r){var i={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(t){e.extend(i,t);var n=u.buildUrl();return r.open(n,i.popupOptions).then(function(t){u.exchangeForToken(t).then(function(t){return t.data})})},u.exchangeForToken=function(t){return n.post(i.url,{code:t.code,clientId:i.clientId,redirectUri:i.redirectUri})},u.buildUrl=function(){var t=i.authorizationEndpoint,e=u.buildQueryString();return[t,e].join("?")},u.buildQueryString=function(){var t=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return e.forEach(n,function(n){e.forEach(i[n],function(e){var n=o.camelCase(e),r=i[n];t.push([e,encodeURIComponent(r)])})}),t.map(function(t){return t.join("=")}).join("&")},u}function a(t){t.interceptors.push(function(t,e,n){return{request:function(t){return e.localStorage.jwtToken&&(t.headers.Authorization="Bearer "+e.localStorage.jwtToken),t},responseError:function(o){return(401===o.status||403===o.status)&&(delete e.localStorage.jwtToken,n.path("/login")),t.reject(o)}}})}function c(t){t.run()}function l(t,e,n,o){return{run:function(){var r=e.localStorage.jwtToken;if(r){var i=JSON.parse(e.atob(r.split(".")[1]));t.currentUser=i.user}var u=e.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);e.opener&&e.opener.location.origin===e.location.origin&&(a.oauth_token&&a.oauth_verifier?e.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&e.opener.postMessage({code:a.code},"*"),e.close())}}}function p(){this.camelCase=function(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(t){var n,o,r={};return e.forEach((t||"").split("&"),function(t){t&&(o=t.split("="),n=decodeURIComponent(o[0]),r[n]=e.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),r}}e.module("Satellizer",[]).provider("$auth",n).factory("RunBlock",l).factory("Local",o).factory("Oauth2",u).factory("Oauth1",i).factory("Popup",r).service("Utils",p).config(a).run(c);var s={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},h={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:t.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:t.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:t.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{url:"/auth/twitter",type:"1.0"}};o.$inject=["$q","$http","$rootScope","$location"],r.$inject=["$q","$interval","$window"],i.$inject=["$q","$http","Popup"],u.$inject=["$q","$http","Utils","Popup"],a.$inject=["$httpProvider"],c.$inject=["RunBlock"],l.$inject=["$rootScope","$window","$location","Utils"]}(window,window.angular);