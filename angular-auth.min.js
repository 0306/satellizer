angular.module("ngAuth",[]).provider("Auth",function(){var t={apiUrl:"/api",logoutRedirect:"/",loginRedirect:"/",loginUrl:"/login",signupUrl:"/signup",oauth2:{clientId:"",redirectUri:"",authorizationEndpoint:"",verifyFunc:"",localStorageName:"accessToken",scopes:[]}};return{configure:function(e){angular.extend(t,e)},$get:["$http","$location","$rootScope","$alert","$window",function(e,o,r,n,a){function i(n){return e.post(t.apiUrl+t.loginUrl,n).success(function(e){a.localStorage.token=e.token;var n=a.localStorage.token,i=JSON.parse(a.atob(n.split(".")[1]));r.currentUser=i.prn,o.path(t.loginRedirect)})}function l(r){return e.post(t.apiUrl+t.signupUrl,r).success(function(){o.path(loginUrl)})}function u(){delete a.localStorage.token,r.currentUser=null,o.path(t.logoutRedirect)}var c=a.localStorage.token;if(c){var s=JSON.parse(a.atob(c.split(".")[1]));Date.now()>s.exp?(a.alert("Token has expired"),delete a.localStorage.token):r.currentUser=s.prn}return{login:i,signup:l,logout:u}}]}}).factory("authInterceptor",["$q","$window","$location",function(t,e,o){return{request:function(t){return e.localStorage.token&&(t.headers.Authorization="Bearer "+e.localStorage.token),t},responseError:function(e){return(401===e.status||403===e.status)&&o.path("/login"),t.reject(e)}}}]).config(["$httpProvider",function(t){t.interceptors.push("authInterceptor")}]);