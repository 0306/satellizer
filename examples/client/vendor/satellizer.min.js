!function(e,t){"use strict";function n(){this.config=s,this.providers=h,this.facebook=function(e){t.extend(h.facebook,e)},this.google=function(e){t.extend(h.google,e)},this.linkedin=function(e){t.extend(h.linkedin,e)},this.github=function(e){t.extend(h.github,e)},this.twitter=function(e){t.extend(h.twitter,e)},this.oauthBase=function(e){h[e.name]=h[e.name]||{},t.extend(h[e.name],e)},this.oauth1=function(e){this.oauthBase(e),h[e.name].type="1.0"},this.oauth2=function(e){this.oauthBase(e),h[e.name].type="2.0"},this.$get=function(e,t,n,o){var i={};return i.authenticate=function(i){var r=e.defer(),u="1.0"===h[i].type?t:n;return u.open(h[i]).then(function(e){o.parseUser(e.token,r)}),r.promise},i.login=function(e){o.login(e)},i.signup=function(e){o.signup(e)},i.logout=function(){o.logout()},i.isAuthenticated=function(){o.isAuthenticated()},i}}function o(t,n,o,i){var r={};return r.parseUser=function(t,n){var r=JSON.parse(e.atob(t.split(".")[1]));localStorage.setItem("jwtToken",t),o[s.user]=r.user,i.path(s.loginRedirect),n.resolve(r.user)},r.login=function(e){var o=t.defer();return n.post(s.loginUrl,e).success(function(e){r.parseUser(e.token,o)}).error(function(e){o.reject(e)}),o.promise},r.signup=function(e){n.post(s.signupUrl,e).then(function(){i.path(s.signupRedirect)})},r.logout=function(){delete o[s.user],localStorage.removeItem("jwtToken"),i.path(s.logoutRedirect)},r.isAuthenticated=function(){return Boolean(o.currentUser)},r}function i(e,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(t,n){var r=e.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(t,"Satellizer",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(e){r=n(function(){i.closed&&(n.cancel(r),e.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(t){t.origin===o.location.origin&&e.resolve(t.data)},!1)},u.prepareOptions=function(e){var n=e.width||500,i=e.height||500;return t.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},e)},u.stringifyOptions=function(e){var n=[];return t.forEach(e,function(e,t){n.push(t+"="+e)}),n.join(",")},u}function r(e,n,o){var i={url:null,name:null,popupOptions:null},r={};return r.open=function(n){t.extend(i,n);var u=e.defer();return o.open(i.url).then(function(e){r.exchangeForToken(e).then(function(e){u.resolve(e.data)})}),u.promise},r.exchangeForToken=function(e){return e=r.buildQueryString(e),n.get(i.url+"?"+e)},r.buildQueryString=function(e){var n=[];return t.forEach(e,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")},r}function u(e,n,o,i){var r={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(n){t.extend(r,n);var o=e.defer(),a=u.buildUrl();return i.open(a,r.popupOptions).then(function(e){u.exchangeForToken(e).then(function(e){o.resolve(e.data)})}),o.promise},u.exchangeForToken=function(e){return n.post(r.url,{code:e.code,clientId:r.clientId,redirectUri:r.redirectUri})},u.buildUrl=function(){var e=r.authorizationEndpoint,t=u.buildQueryString();return[e,t].join("?")},u.buildQueryString=function(){var e=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return t.forEach(n,function(n){t.forEach(r[n],function(t){var n=o.camelCase(t),i=r[n];e.push([t,encodeURIComponent(i)])})}),e.map(function(e){return e.join("=")}).join("&")},u}function a(e){e.interceptors.push(function(e,t,n){return{request:function(e){return t.localStorage.jwtToken&&(e.headers.Authorization="Bearer "+t.localStorage.jwtToken),e},responseError:function(o){return(401===o.status||403===o.status)&&(delete t.localStorage.jwtToken,n.path("/login")),e.reject(o)}}})}function c(e){e.run()}function l(e,t,n,o){return{run:function(){var i=t.localStorage.jwtToken;if(i){var r=JSON.parse(t.atob(i.split(".")[1]));e.currentUser=r.user}var u=t.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);t.opener&&t.opener.location.origin===t.location.origin&&(a.oauth_token&&a.oauth_verifier?t.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&t.opener.postMessage({code:a.code},"*"),t.close())}}}function p(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(e){var n,o,i={};return t.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),n=decodeURIComponent(o[0]),i[n]=t.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}t.module("Satellizer",[]).provider("$auth",n).factory("RunBlock",l).factory("Local",o).factory("Oauth2",u).factory("Oauth1",r).factory("Popup",i).service("Utils",p).config(a).run(c);var s={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},h={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:e.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}};o.$inject=["$q","$http","$rootScope","$location"],i.$inject=["$q","$interval","$window"],r.$inject=["$q","$http","Popup"],u.$inject=["$q","$http","Utils","Popup"],a.$inject=["$httpProvider"],c.$inject=["RunBlock"],l.$inject=["$rootScope","$window","$location","Utils"]}(window,window.angular);