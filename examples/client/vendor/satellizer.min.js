!function(e,t){"use strict";var n={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser"},o={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:e.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}};t.module("Satellizer",[]).provider("$auth",function(){this.config=n,this.providers=o,this.facebook=function(e){t.extend(o.facebook,e)},this.google=function(e){t.extend(o.google,e)},this.linkedin=function(e){t.extend(o.linkedin,e)},this.github=function(e){t.extend(o.github,e)},this.twitter=function(e){t.extend(o.twitter,e)},this.oauthBase=function(e){o[e.name]=o[e.name]||{},t.extend(o[e.name],e)},this.oauth1=function(e){this.oauthBase(e),o[e.name].type="1.0"},this.oauth2=function(e){this.oauthBase(e),o[e.name].type="2.0"},this.$get=["$q","Oauth1","Oauth2","Local",function(e,t,n,i){var r={};return r.authenticate=function(r){var u=e.defer(),a="1.0"===o[r].type?t:n;return a.open(o[r]).then(function(e){i.parseUser(e.token,u)}),u.promise},r.login=function(e){i.login(e)},r.signup=function(e){i.signup(e)},r.logout=function(){i.logout()},r.isAuthenticated=function(){i.isAuthenticated()},r}]}).factory("Local",["$q","$http","$rootScope","$location",function(t,o,i,r){var u={};return u.parseUser=function(t,o){var u=JSON.parse(e.atob(t.split(".")[1]));localStorage.setItem("jwtToken",t),i[n.user]=u.user,r.path(n.loginRedirect),o.resolve(u.user)},u.login=function(e){var i=t.defer();return o.post(n.loginUrl,e).success(function(e){u.parseUser(e.token,i)}).error(function(e){i.reject(e)}),i.promise},u.signup=function(e){o.post(n.signupUrl,e).then(function(){r.path(n.signupRedirect)})},u.logout=function(){delete i[n.user],localStorage.removeItem("jwtToken"),r.path(n.logoutRedirect)},u.isAuthenticated=function(){return Boolean(i.currentUser)},u}]).factory("Oauth2",["$q","$http","Utils","Popup",function(e,n,o,i){var r={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(n){t.extend(r,n);var o=e.defer(),a=u.buildUrl();return i.open(a,r.popupOptions).then(function(e){u.exchangeForToken(e).then(function(e){o.resolve(e.data)})}),o.promise},u.exchangeForToken=function(e){return n.post(r.url,{code:e.code,clientId:r.clientId,redirectUri:r.redirectUri})},u.buildUrl=function(){var e=r.authorizationEndpoint,t=u.buildQueryString();return[e,t].join("?")},u.buildQueryString=function(){var e=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return t.forEach(n,function(n){t.forEach(r[n],function(t){var n=o.camelCase(t),i=r[n];e.push([t,encodeURIComponent(i)])})}),e.map(function(e){return e.join("=")}).join("&")},u}]).factory("Oauth1",["$q","$http","Popup",function(e,n,o){var i={url:null,name:null,popupOptions:null},r={};return r.open=function(n){t.extend(i,n);var u=e.defer();return o.open(i.url).then(function(e){r.exchangeForToken(e).then(function(e){u.resolve(e.data)})}),u.promise},r.exchangeForToken=function(e){return e=r.buildQueryString(e),n.get(i.url+"?"+e)},r.buildQueryString=function(e){var n=[];return t.forEach(e,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")},r}]).factory("Popup",["$q","$interval","$window",function(e,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(t,n){var r=e.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(t,"Satellizer",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(e){r=n(function(){i.closed&&(n.cancel(r),e.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(t){t.origin===o.location.origin&&e.resolve(t.data)},!1)},u.prepareOptions=function(e){var n=e.width||500,i=e.height||500;return t.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},e)},u.stringifyOptions=function(e){var n=[];return t.forEach(e,function(e,t){n.push(t+"="+e)}),n.join(",")},u}]).factory("RunBlock",["$rootScope","$window","$location","Utils",function(e,t,n,o){return{run:function(){var i=t.localStorage.jwtToken;if(i){var r=JSON.parse(t.atob(i.split(".")[1]));e.currentUser=r.user}var u=t.location.search.substring(1),a=Object.keys(n.search()).length?n.search():o.parseQueryString(u);t.opener&&t.opener.location.origin===t.location.origin&&(a.oauth_token&&a.oauth_verifier?t.opener.postMessage({oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier},"*"):a.code&&t.opener.postMessage({code:a.code},"*"),t.close())}}}]).service("Utils",function(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(e){var n,o,i={};return t.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),n=decodeURIComponent(o[0]),i[n]=t.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}).config(["$httpProvider",function(e){e.interceptors.push(["$q","$window","$location",function(e,t,n){return{request:function(e){return t.localStorage.jwtToken&&(e.headers.Authorization="Bearer "+t.localStorage.jwtToken),e},responseError:function(o){return(401===o.status||403===o.status)&&(delete t.localStorage.jwtToken,n.path("/login")),e.reject(o)}}}])}]).run(["RunBlock",function(e){e.run()}])}(window,window.angular);